import{r as o,u as Q,a as V,I as w,M as K,j as s,B as z,H as J,t as X,b as Z}from"./index-DxP0e4Mz.js";import{u as ss}from"./useUserNFTs-CWcNIXRR.js";const es={Pradera:0,Desierto:1,Volcanico:2,"Cyber-Monad":3,Eldorado:4};function ns({lang:t,setLang:E,wallet:i}){const g=X[t],[p,T]=o.useState("stake"),[u,y]=o.useState(""),[r,d]=o.useState([]),[f,j]=o.useState(null),{stats:N,userInfo:l,isApproved:L,approve:B,stake:M,stakeMany:R,unstake:_,isLoading:m,isSuccess:k,error:S,refetch:F,biomeNames:O,biomeRewards:b}=Q(i.address),{balance:h,tokenIds:$,loading:P}=ss(i.address),{leaderboard:A,isLoading:Y,error:W}=V(),C=o.useCallback(async e=>{try{const a=await fetch(`${w}${K}/${e}.json`);if(!a.ok)return null;const c=(await a.json()).attributes?.find(x=>x.trait_type==="Biome");if(c){const x=c.value,H=es[x]??0;return{biome:x,biomeType:H}}return{biome:"Unknown",biomeType:0}}catch{return null}},[]),I=async()=>{j(null);const e=parseInt(u.trim());if(isNaN(e)||e<1||e>6e3){j(t==="es"?"Token ID debe ser 1-6000":"Token ID must be 1-6000");return}if(r.some(n=>n.tokenId===e)){j(t==="es"?"NFT ya agregado":"NFT already added");return}d(n=>[...n,{tokenId:e,biome:"...",biomeType:0,loading:!0}]),y("");const a=await C(e);a?d(n=>n.map(c=>c.tokenId===e?{...c,biome:a.biome,biomeType:a.biomeType,loading:!1}:c)):(j(t==="es"?"No se pudo cargar NFT":"Could not load NFT"),d(n=>n.filter(c=>c.tokenId!==e)))},D=e=>{d(a=>a.filter(n=>n.tokenId!==e))},q=async e=>{if(r.some(n=>n.tokenId===e)){D(e);return}d(n=>[...n,{tokenId:e,biome:"...",biomeType:0,loading:!0}]);const a=await C(e);d(a?n=>n.map(c=>c.tokenId===e?{...c,biome:a.biome,biomeType:a.biomeType,loading:!1}:c):n=>n.filter(c=>c.tokenId!==e))},U=async()=>{if(r.length!==0)if(r.length===1)await M(BigInt(r[0].tokenId),r[0].biomeType);else{const e=r.map(n=>BigInt(n.tokenId)),a=r.map(n=>n.biomeType);await R(e,a)}};o.useEffect(()=>{k&&d([])},[k]),o.useEffect(()=>{k&&setTimeout(()=>F(),2e3)},[k,F]);const G=e=>`${e.slice(0,6)}...${e.slice(-4)}`,v=e=>`${w}${Z}/${e}.png`;return s.jsxs("div",{className:"app",children:[s.jsx(z,{}),s.jsx(J,{lang:t,setLang:E,isAnyConnected:i.isAnyConnected,currentAddress:i.currentAddress,web3AuthConnected:i.web3AuthConnected,onDisconnect:i.disconnect,onConnectClick:()=>i.setShowWalletModal(!0)}),s.jsxs("div",{className:"stake-page",children:[s.jsxs("div",{className:"stake-header",children:[s.jsx("h1",{children:"$LAND Staking"}),s.jsx("p",{className:"stake-subtitle",children:t==="es"?"Stakea tus NFTs para ganar $LAND tokens diariamente":"Stake your NFTs to earn $LAND tokens daily"})]}),s.jsxs("div",{className:"stake-stats-grid",children:[s.jsxs("div",{className:"stake-stat-card",children:[s.jsx("span",{className:"stat-icon",children:"ðŸ”ï¸"}),s.jsxs("div",{className:"stat-info",children:[s.jsx("span",{className:"stat-value",children:N.totalStaked}),s.jsx("span",{className:"stat-label",children:"NFTs Staked"})]})]}),s.jsxs("div",{className:"stake-stat-card",children:[s.jsx("span",{className:"stat-icon",children:"ðŸ‘¥"}),s.jsxs("div",{className:"stat-info",children:[s.jsx("span",{className:"stat-value",children:N.totalStakers}),s.jsx("span",{className:"stat-label",children:"Stakers"})]})]}),s.jsxs("div",{className:"stake-stat-card",children:[s.jsx("span",{className:"stat-icon",children:"ðŸ’°"}),s.jsxs("div",{className:"stat-info",children:[s.jsx("span",{className:"stat-value",children:parseFloat(N.totalFeesCollected).toFixed(1)}),s.jsx("span",{className:"stat-label",children:"MON Collected"})]})]}),s.jsxs("div",{className:"stake-stat-card",children:[s.jsx("span",{className:"stat-icon",children:"ðŸŽ«"}),s.jsxs("div",{className:"stat-info",children:[s.jsxs("span",{className:"stat-value",children:[N.stakingFee," MON"]}),s.jsx("span",{className:"stat-label",children:"Fee per NFT"})]})]})]}),i.isAnyConnected&&s.jsxs("div",{className:"user-stake-stats",children:[s.jsx("h3",{children:t==="es"?"Tu Staking":"Your Staking"}),s.jsxs("div",{className:"user-stats-row",children:[s.jsxs("div",{className:"user-stat",children:[s.jsx("span",{className:"user-stat-value",children:l.stakedCount}),s.jsx("span",{className:"user-stat-label",children:"Staked"})]}),s.jsxs("div",{className:"user-stat",children:[s.jsx("span",{className:"user-stat-value",children:parseFloat(l.pendingRewards).toFixed(2)}),s.jsx("span",{className:"user-stat-label",children:"Pending $LAND"})]}),s.jsxs("div",{className:"user-stat",children:[s.jsx("span",{className:"user-stat-value",children:parseFloat(l.landBalance).toFixed(2)}),s.jsx("span",{className:"user-stat-label",children:"$LAND Balance"})]})]}),parseFloat(l.pendingRewards)>0&&s.jsxs("div",{className:"claim-info",children:[s.jsxs("span",{className:"claim-amount",children:[parseFloat(l.pendingRewards).toFixed(2)," $LAND"]}),s.jsx("span",{className:"claim-status",children:t==="es"?"Acumulando... Claim prÃ³ximamente":"Accumulating... Claim coming soon"})]})]}),s.jsxs("div",{className:"stake-main-layout",children:[s.jsxs("div",{className:"stake-left",children:[s.jsxs("div",{className:"stake-tabs",children:[s.jsx("button",{className:`stake-tab ${p==="stake"?"active":""}`,onClick:()=>T("stake"),children:t==="es"?"Stakear":"Stake"}),s.jsxs("button",{className:`stake-tab ${p==="staked"?"active":""}`,onClick:()=>T("staked"),children:[t==="es"?"Stakeados":"Staked"," (",l.stakedCount,")"]})]}),s.jsx("div",{className:"stake-content",children:i.isAnyConnected?p==="stake"?s.jsx("div",{className:"stake-available",children:L?s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"stake-hint",children:t==="es"?`Tienes ${h} NFTs. Click para seleccionar o escribe el ID. Sin lock - retira cuando quieras.`:`You have ${h} NFTs. Click to select or type the ID. No lock - withdraw anytime.`}),h>0&&s.jsxs("div",{className:"available-nfts",children:[$.length>0&&s.jsxs("div",{className:"quick-select-section",children:[s.jsx("p",{className:"quick-select-hint",children:t==="es"?"SelecciÃ³n rÃ¡pida:":"Quick select:"}),s.jsx("div",{className:"nfts-thumb-grid",children:$.map(e=>s.jsxs("div",{className:`nft-thumb ${r.some(a=>a.tokenId===e)?"selected":""}`,onClick:()=>q(e),children:[s.jsx("img",{src:v(e),alt:`#${e}`,onError:a=>{a.target.src="/placeholder.png"}}),s.jsxs("span",{className:"thumb-id",children:["#",e]}),r.some(a=>a.tokenId===e)&&s.jsx("span",{className:"thumb-check",children:"âœ“"})]},e))}),h>10&&s.jsx("p",{className:"more-nfts-hint",children:t==="es"?`Mostrando 10 de ${h}. Escribe el ID abajo para otros.`:`Showing 10 of ${h}. Type ID below for others.`})]}),P&&s.jsx("div",{className:"nfts-loading-small",children:t==="es"?"Cargando miniaturas...":"Loading thumbnails..."})]}),s.jsxs("div",{className:"stake-input-section",children:[s.jsxs("div",{className:"stake-input-row",children:[s.jsx("input",{type:"text",placeholder:"Token ID (1-6000)",value:u,onChange:e=>y(e.target.value),onKeyDown:e=>e.key==="Enter"&&I(),className:"stake-input"}),s.jsx("button",{onClick:I,className:"btn-add-nft",disabled:!u.trim(),children:t==="es"?"Agregar":"Add"})]}),f&&s.jsx("p",{className:"stake-input-error",children:f})]}),r.length>0&&s.jsxs("div",{className:"nfts-to-stake-section",children:[s.jsxs("h4",{children:[t==="es"?"NFTs a Stakear":"NFTs to Stake"," (",r.length,")"]}),s.jsx("div",{className:"nfts-to-stake-grid",children:r.map(e=>s.jsxs("div",{className:`stake-card ${e.loading?"loading":""}`,children:[s.jsx("img",{src:v(e.tokenId),alt:`#${e.tokenId}`,className:"stake-card-img",onError:a=>{a.target.src="/placeholder.png"}}),s.jsxs("div",{className:"stake-card-info",children:[s.jsxs("span",{className:"stake-card-id",children:["#",e.tokenId]}),s.jsx("span",{className:`stake-card-biome biome-tag-${e.biomeType}`,children:e.loading?"...":e.biome}),s.jsx("span",{className:"stake-card-reward",children:e.loading?"...":`${b[e.biomeType]} $LAND/day`})]}),s.jsx("button",{className:"btn-remove-card",onClick:()=>D(e.tokenId),title:t==="es"?"Quitar":"Remove",children:"âœ•"})]},e.tokenId))}),s.jsxs("div",{className:"stake-summary",children:[s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:t==="es"?"Total $LAND/dÃ­a:":"Total $LAND/day:"}),s.jsx("span",{className:"summary-value",children:r.reduce((e,a)=>e+(a.loading?0:b[a.biomeType]),0)})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:t==="es"?"Fee total:":"Total fee:"}),s.jsxs("span",{className:"summary-value",children:[(parseFloat(N.stakingFee)*r.length).toFixed(1)," MON"]})]})]}),s.jsx("button",{className:"btn-stake-all",onClick:U,disabled:m||r.some(e=>e.loading),children:m?t==="es"?"Stakeando...":"Staking...":t==="es"?`Stakear ${r.length} NFT${r.length>1?"s":""}`:`Stake ${r.length} NFT${r.length>1?"s":""}`})]}),s.jsxs("div",{className:"rewards-table",children:[s.jsx("h4",{children:t==="es"?"Recompensas por Bioma":"Rewards by Biome"}),s.jsx("div",{className:"rewards-grid",children:O.map((e,a)=>s.jsxs("div",{className:`reward-item biome-${a}`,children:[s.jsx("span",{className:"biome-name",children:e}),s.jsxs("span",{className:"biome-reward",children:[b[a]," $LAND/day"]})]},e))})]}),s.jsxs("div",{className:"marketplace-links",children:[s.jsx("p",{children:t==="es"?"Busca tus Token IDs en:":"Find your Token IDs at:"}),s.jsxs("div",{className:"marketplace-buttons",children:[s.jsx("a",{href:`https://magiceden.io/u/${i.address}?chains=%5B%22monad%22%5D`,target:"_blank",rel:"noopener noreferrer",className:"marketplace-btn magic-eden",children:"Magic Eden"}),s.jsx("a",{href:`https://opensea.io/${i.address}?tab=collected`,target:"_blank",rel:"noopener noreferrer",className:"marketplace-btn opensea",children:"OpenSea"})]})]})]}):s.jsxs("div",{className:"approval-needed",children:[s.jsx("p",{children:t==="es"?"Primero debes aprobar el contrato de staking":"First, approve the staking contract"}),s.jsx("button",{className:"btn-approve",onClick:B,disabled:m,children:m?"Approving...":"Approve Staking"})]})}):p==="staked"?s.jsx("div",{className:"staked-nfts",children:l.stakedTokenIds.length===0?s.jsxs("div",{className:"no-staked",children:[s.jsx("span",{className:"no-staked-icon",children:"ðŸ“­"}),s.jsx("p",{children:t==="es"?"No tienes NFTs stakeados":"You have no staked NFTs"})]}):s.jsx("div",{className:"staked-grid",children:l.stakedTokenIds.map(e=>s.jsxs("div",{className:"staked-card",children:[s.jsx("img",{src:v(Number(e)),alt:`Land #${e}`,className:"staked-img",onError:a=>{a.target.src="/placeholder.png"}}),s.jsxs("div",{className:"staked-info",children:[s.jsxs("span",{className:"staked-id",children:["#",e.toString()]}),s.jsx("button",{className:"btn-unstake",onClick:()=>_(e),disabled:m,children:m?"...":"Unstake"})]})]},e.toString()))})}):null:s.jsxs("div",{className:"stake-connect",children:[s.jsx("span",{className:"connect-icon",children:"ðŸ”’"}),s.jsx("p",{children:g.connectToViewLands||"Connect your wallet to start staking"}),s.jsx("button",{onClick:()=>i.setShowWalletModal(!0),className:"btn-connect-stake",children:g.connectWallet})]})})]}),s.jsx("div",{className:"stake-right",children:s.jsxs("div",{className:"leaderboard-sidebar",children:[s.jsx("h3",{className:"leaderboard-title",children:"ðŸ† Leaderboard"}),s.jsxs("div",{className:"leaderboard-header",children:[s.jsx("span",{className:"lb-rank",children:"#"}),s.jsx("span",{className:"lb-address",children:"Address"}),s.jsx("span",{className:"lb-staked",children:"Staked"})]}),Y?s.jsx("div",{className:"no-stakers",children:s.jsx("p",{children:t==="es"?"Cargando...":"Loading..."})}):W?s.jsx("div",{className:"no-stakers",children:s.jsx("p",{children:t==="es"?"Error cargando leaderboard":"Error loading leaderboard"})}):A.length===0?s.jsx("div",{className:"no-stakers",children:s.jsx("p",{children:t==="es"?"Sin stakers aun":"No stakers yet"})}):A.map((e,a)=>s.jsxs("div",{className:`leaderboard-row ${a<3?`top-${a+1}`:""}`,children:[s.jsx("span",{className:`lb-rank ${a<3?"lb-rank-top":""}`,children:a===0?"ðŸ‘‘":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":a+1}),s.jsx("span",{className:"lb-address",children:G(e.address)}),s.jsx("span",{className:"lb-staked",children:e.stakedCount})]},e.address))]})})]}),S&&s.jsx("div",{className:"stake-error",children:s.jsxs("p",{children:["Error: ",S.message]})}),k&&s.jsx("div",{className:"stake-success",children:s.jsx("p",{children:t==="es"?"Transaccion exitosa!":"Transaction successful!"})})]})]})}export{ns as Stake};
